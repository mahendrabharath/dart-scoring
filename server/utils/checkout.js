// Checkout suggestions for finishing a game
// Returns the best way to finish with remaining darts

const CHECKOUTS = {
  // Single dart finishes
  170: 'T20 T20 Bull',
  167: 'T20 T19 Bull',
  164: 'T20 T18 Bull',
  161: 'T20 T17 Bull',
  160: 'T20 T20 D20',
  158: 'T20 T20 D19',
  157: 'T20 T19 D20',
  156: 'T20 T20 D18',
  155: 'T20 T19 D19',
  154: 'T20 T18 D20',
  153: 'T20 T19 D18',
  152: 'T20 T20 D16',
  151: 'T20 T17 D20',
  150: 'T20 T18 D18',
  149: 'T20 T19 D16',
  148: 'T20 T20 D14',
  147: 'T20 T17 D18',
  146: 'T20 T18 D16',
  145: 'T20 T19 D14',
  144: 'T20 T20 D12',
  143: 'T20 T17 D16',
  142: 'T20 T18 D14',
  141: 'T20 T19 D12',
  140: 'T20 T20 D10',
  139: 'T19 T20 D11',
  138: 'T20 T18 D12',
  137: 'T20 T19 D10',
  136: 'T20 T20 D8',
  135: 'T20 T17 D12',
  134: 'T20 T18 D10',
  133: 'T20 T19 D8',
  132: 'T20 T20 D6',
  131: 'T20 T17 D10',
  130: 'T20 T20 D5',
  129: 'T19 T20 D6',
  128: 'T18 T20 D7',
  127: 'T20 T17 D8',
  126: 'T19 T19 D6',
  125: 'T20 T19 D4',
  124: 'T20 T20 D2',
  123: 'T19 T20 D3',
  122: 'T18 T20 D4',
  121: 'T20 T17 D5',
  120: 'T20 S20 D20',
  119: 'T19 T20 D1',
  118: 'T20 T18 D2',
  117: 'T20 T19 D0',
  116: 'T20 S16 D20',
  115: 'T20 T15 D5',
  114: 'T20 S14 D20',
  113: 'T20 T19 D-',
  112: 'T20 T12 D8',
  111: 'T20 T17 D0',
  110: 'T20 S10 D20',
  109: 'T20 S9 D20',
  108: 'T20 S8 D20',
  107: 'T20 S7 D20',
  106: 'T20 S6 D20',
  105: 'T20 S5 D20',
  104: 'T20 S4 D20',
  103: 'T20 S3 D20',
  102: 'T20 S2 D20',
  101: 'T20 S1 D20',
  100: 'T20 D20',
  99: 'T19 D21',
  98: 'T20 D19',
  97: 'T19 D20',
  96: 'T20 D18',
  95: 'T19 D19',
  94: 'T18 D20',
  93: 'T19 D18',
  92: 'T20 D16',
  91: 'T17 D20',
  90: 'T20 D15',
  89: 'T19 D16',
  88: 'T20 D14',
  87: 'T17 D18',
  86: 'T18 D16',
  85: 'T19 D14',
  84: 'T20 D12',
  83: 'T17 D16',
  82: 'T18 D14',
  81: 'T19 D12',
  80: 'T20 D10',
  79: 'T19 D11',
  78: 'T18 D12',
  77: 'T19 D10',
  76: 'T20 D8',
  75: 'T17 D12',
  74: 'T18 D10',
  73: 'T19 D8',
  72: 'T20 D6',
  71: 'T17 D10',
  70: 'T18 D8',
  69: 'T19 D6',
  68: 'T20 D4',
  67: 'T17 D8',
  66: 'T18 D6',
  65: 'T19 D4',
  64: 'T16 D8',
  63: 'T17 D6',
  62: 'T18 D4',
  61: 'T19 D2',
  60: 'S20 D20',
  59: 'S19 D20',
  58: 'S18 D20',
  57: 'S17 D20',
  56: 'S16 D20',
  55: 'S15 D20',
  54: 'S14 D20',
  53: 'S13 D20',
  52: 'S12 D20',
  51: 'S11 D20',
  50: 'Bull',
  49: 'S17 D16',
  48: 'S16 D16',
  47: 'S15 D16',
  46: 'S14 D16',
  45: 'S13 D16',
  44: 'S12 D16',
  43: 'S11 D16',
  42: 'S10 D16',
  41: 'S9 D16',
  40: 'D20',
  39: 'S7 D16',
  38: 'D19',
  37: 'S5 D16',
  36: 'D18',
  35: 'S3 D16',
  34: 'D17',
  33: 'S1 D16',
  32: 'D16',
  31: 'S15 D8',
  30: 'D15',
  29: 'S13 D8',
  28: 'D14',
  27: 'S11 D8',
  26: 'D13',
  25: 'S9 D8',
  24: 'D12',
  23: 'S7 D8',
  22: 'D11',
  21: 'S5 D8',
  20: 'D10',
  19: 'S3 D8',
  18: 'D9',
  17: 'S1 D8',
  16: 'D8',
  15: 'S7 D4',
  14: 'D7',
  13: 'S5 D4',
  12: 'D6',
  11: 'S3 D4',
  10: 'D5',
  9: 'S1 D4',
  8: 'D4',
  7: 'S3 D2',
  6: 'D3',
  5: 'S1 D2',
  4: 'D2',
  3: 'S1 D1',
  2: 'D1'
};

// Extended checkouts for 2-dart and 3-dart finishes
const TWO_DART_CHECKOUTS = {
  100: 'T20 D20',
  99: 'T19 D21',
  98: 'T20 D19',
  97: 'T19 D20',
  96: 'T20 D18',
  95: 'T19 D19',
  94: 'T18 D20',
  93: 'T19 D18',
  92: 'T20 D16',
  91: 'T17 D20',
  90: 'T20 D15',
  89: 'T19 D16',
  88: 'T20 D14',
  87: 'T17 D18',
  86: 'T18 D16',
  85: 'T19 D14',
  84: 'T20 D12',
  83: 'T17 D16',
  82: 'T18 D14',
  81: 'T19 D12',
  80: 'T20 D10',
  79: 'T19 D11',
  78: 'T18 D12',
  77: 'T19 D10',
  76: 'T20 D8',
  75: 'T17 D12',
  74: 'T18 D10',
  73: 'T19 D8',
  72: 'T20 D6',
  71: 'T17 D10',
  70: 'T18 D8',
  69: 'T19 D6',
  68: 'T20 D4',
  67: 'T17 D8',
  66: 'T18 D6',
  65: 'T19 D4',
  64: 'T16 D8',
  63: 'T17 D6',
  62: 'T18 D4',
  61: 'T19 D2',
  60: 'S20 D20',
  59: 'S19 D20',
  58: 'S18 D20',
  57: 'S17 D20',
  56: 'S16 D20',
  55: 'S15 D20',
  54: 'S14 D20',
  53: 'S13 D20',
  52: 'S12 D20',
  51: 'S11 D20',
  50: 'Bull',
  49: 'S17 D16',
  48: 'S16 D16',
  47: 'S15 D16',
  46: 'S14 D16',
  45: 'S13 D16',
  44: 'S12 D16',
  43: 'S11 D16',
  42: 'S10 D16',
  41: 'S9 D16',
  40: 'D20',
  39: 'S7 D16',
  38: 'D19',
  37: 'S5 D16',
  36: 'D18',
  35: 'S3 D16',
  34: 'D17',
  33: 'S1 D16',
  32: 'D16',
  31: 'S15 D8',
  30: 'D15',
  29: 'S13 D8',
  28: 'D14',
  27: 'S11 D8',
  26: 'D13',
  25: 'S9 D8',
  24: 'D12',
  23: 'S7 D8',
  22: 'D11',
  21: 'S5 D8',
  20: 'D10',
  19: 'S3 D8',
  18: 'D9',
  17: 'S1 D8',
  16: 'D8',
  15: 'S7 D4',
  14: 'D7',
  13: 'S5 D4',
  12: 'D6',
  11: 'S3 D4',
  10: 'D5',
  9: 'S1 D4',
  8: 'D4',
  7: 'S3 D2',
  6: 'D3',
  5: 'S1 D2',
  4: 'D2',
  3: 'S1 D1',
  2: 'D1'
};

function calculateCheckout(score) {
  if (score <= 0) {
    return null;
  }

  if (score > 170) {
    // For scores above 170, suggest high scoring throws
    if (score <= 180) {
      return 'T20 T20 T20 (then checkout)';
    }
    return `Score ${score - 170} points, then checkout`;
  }

  // Direct checkout available
  if (CHECKOUTS[score]) {
    return {
      method: CHECKOUTS[score],
      darts: score <= 100 ? 2 : 3,
      score: score
    };
  }

  // Find best 2-dart finish
  if (score <= 100 && TWO_DART_CHECKOUTS[score]) {
    return {
      method: TWO_DART_CHECKOUTS[score],
      darts: 2,
      score: score
    };
  }

  // For scores that can't be finished directly, suggest setup
  if (score > 100 && score <= 170) {
    // Try to get to a finishable score
    const target = 100; // Aim for 100 or less
    const needed = score - target;
    if (needed <= 60) {
      return {
        method: `Score ${needed} (aim for 100), then ${TWO_DART_CHECKOUTS[100] || 'checkout'}`,
        darts: 3,
        score: score
      };
    }
    // For scores 101-170, suggest high scoring
    return {
      method: `Score high (aim for ${score - 100} or less)`,
      darts: 3,
      score: score
    };
  }

  // For odd scores that can't be finished, suggest even score
  if (score % 2 === 1 && score > 1 && score <= 100) {
    return {
      method: `Score 1 (get to ${score - 1}), then checkout`,
      darts: 3,
      score: score
    };
  }

  // Default suggestion
  if (score > 170) {
    return {
      method: `Score ${score - 170} points, then checkout`,
      darts: 3,
      score: score
    };
  }

  return {
    method: 'Setup for checkout',
    darts: 3,
    score: score
  };
}

module.exports = {
  calculateCheckout
};

